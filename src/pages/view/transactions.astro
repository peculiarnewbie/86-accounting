---
import type { DataType } from "../../../db/schema";
import TransactionsView from "../../components/TransactionsView";
import Layout from "../../layouts/Layout.astro";
import { parseParams } from "../../helpers/dateHelpers";

const url = new URL(Astro.request.url);
const searchParams = new URLSearchParams(url.search);
const date = parseParams(searchParams);

const response = await fetch(Astro.request.url.replace("view", "api"));
const data = (await response.json()) as DataType[];

let editing = false;
if (searchParams.get("edit")) {
    // TODO: give middleware to check if admin instead
    // then let admin edit on client side
    editing = true;
}
---

<Layout title="transactions">
    <TransactionsView
        client:load
        data={data}
        date={date.valueOf()}
        editing={editing}
    />
</Layout>
